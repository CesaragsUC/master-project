name: Code Quality and Deploy
on:
  push:
    branches:
      - main
      - 'feature/**'
      - 'hotfix/**'

  pull_request:
    types: [opened, synchronize, reopened,edited]
    
  workflow_dispatch:
    inputs:
      version:
        description: "New version for all projects"
        required: true 
        type: string

jobs:

  build:
    name: Executing build
    runs-on: ubuntu-latest
    concurrency:
      group: example-group
      cancel-in-progress: true    
    steps:
      
        - name: Fetching project code ‚è≥
          uses: actions/checkout@v4
        - name: Setup dotnet
          uses: actions/setup-dotnet@v4
          with:
              dotnet-version: 8.0.300
        - name: Executing dotnet build
          working-directory: .
          run: dotnet build CasoftStore.sln

  tests:
        needs: build
        uses: CesaragsUC/master-project/.github/workflows/test.yml@main
        secrets: inherit

  # create-release:
  #       needs: tests
  #       uses: CesaragsUC/master-project/.github/workflows/release.yml@main
  #       secrets: inherit

                 
  
  deploy:
        needs: create-release
        uses: CesaragsUC/master-project/.github/workflows/deploy.yml@main
        with:
            version: ${{ needs.release.outputs.new_tag }}
        secrets: inherit

# in case using Cursor IDE
# ctrl+m+c  to comment
# ctrl+m+u  to uncomment        