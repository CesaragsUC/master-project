name: Code Quality and Deploy
on:
  push:
    branches:
      - main
      - 'feature/**'
      - 'hotfix/**'
      - 'release/**'
  pull_request:
    types: [opened, synchronize, reopened,edited]
    
  workflow_dispatch:


jobs:

  build:
    name: Executing build
    runs-on: ubuntu-latest
    steps:
      
        - name: Fetching project code ‚è≥
          uses: actions/checkout@v4
        - name: Setup dotnet
          uses: actions/setup-dotnet@v4
          with:
              dotnet-version: 8.0.300
        - name: Executing dotnet build
          working-directory: .
          run: dotnet build CasoftStore.sln

  tests:
        needs: build
        uses: CesaragsUC/master-project/.github/workflows/test.yml@main
        secrets: inherit

  # release:
  #       name: Creating release
  #       runs-on: ubuntu-latest
  #      # needs: tests
  #       permissions:
  #           security-events: write  # Permiss√£o para publicar na aba de seguran√ßa
  #       outputs:
  #           clean_version: ${{ steps.clean_version.outputs.clean_version }}
  #       steps:
  #           - name: Checkout code
  #             uses: actions/checkout@v4
  #             with:
  #               fetch-depth: 0
  #               fetch-tags: true
  #           - name: Checkout code
  #             uses: actions/checkout@v3
  #             with:
  #               fetch-depth: 0
  #               fetch-tags: true

  #           - name: Calculate Semantic Version tag
  #             id: semver-tag
  #             uses: gandarez/semver-action@v2.0.0
  #             with:
  #               branching_model: "trunk-based"
  #               main_branch_name: "main"
  #               major_regex: "(?i)^(.+:)?(release/.+)"
  #               minor_regex: "(?i)^(.+:)?(feature/.+)"
  #               patch_regex: "(?i)^(.+:)?(hotfix/.+)"
  #               debug: "true"

  #           - name: üîñ Create Git Tag
  #             uses: rickstaa/action-create-tag@v1.7.2
  #             with:
  #               tag: ${{ steps.semver-tag.outputs.semver_tag }}

  #           - name: New tag version
  #             run: |
  #               echo "tag:  ${{ env.VERSION }}"
